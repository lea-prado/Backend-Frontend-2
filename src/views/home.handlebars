<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{title}}</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <h1>{{title}}</h1>

  {{#if user}}
    <p>Bienvenido, {{user.first_name}} | <a href="/logout">Cerrar Sesión</a></p>
  {{else}}
    <p>
      <a href="/login">Iniciar Sesión</a> | 
      <a href="/register">Registrarse</a>
    </p>
  {{/if}}

  {{#if products.length}}
    <ul>
      {{#each products}}
        <li>
          <h3>{{this.title}}</h3>
          <p>{{this.description}}</p>
          <p>Precio: ${{this.price}}</p>
          <p>Stock: {{this.stock}}</p>
          
          {{#if ../user}}
            {{#if (eq ../user.role "user")}}
              <!-- Formulario para agregar al carrito -->
              <form action="/api/carts/{{../user.cart._id}}/add/{{this._id}}" method="POST" style="display:inline;">
                <input type="number" name="quantity" value="1" min="1" style="width: 50px;">
                <button type="submit">Agregar al Carrito</button>
              </form>
            {{/if}}
            {{#if (eq ../user.role "admin")}}
              <p><a href="/api/products/view">Administrar Productos</a></p>
            {{/if}}
          {{/if}}
        </li>
      {{/each}}
    </ul>
  {{else}}
    <p>No hay productos disponibles.</p>
  {{/if}}

  <p><a href="/cart">Ver Mi Carrito</a></p>
</body>
</html>
